#!/bin/bash

. /HolismHolding/Infra/Scripts/CleanDocker.sh
. /HolismHolding/Infra/Scripts/Message.sh

function GetOrganizationDatabaseHost()
{
    IFS='.' read -r -a array <<< "api.freya.center"
    echo "${array[@]}"
    min=0
    max=$(( ${#array[@]} -1 ))
    while [[ min -lt max ]]
    do
        # Swap current first and last elements
        x="${array[$min]}"
        array[$min]="${array[$max]}"
        array[$max]="$x"

        # Move closer
        (( min++, max-- ))
    done
    echo "${array[@]}"
}

function CreateMariaDatabaseContainer()
{
    Info 'Creating MariaDB container'
    ComposeFile=/Temp/$Organization/MariaDockerCompose.yml
    mkdir -p $(dirname $ComposeFile)
    envsubst < /HolismHolding/Infra/Maria/Dev/DockerCompose.yml > $ComposeFile
    docker-compose -p "${Organization}Databases" -f $ComposeFile up --remove-orphans
}

function CreateDatabaseContainer()
{
    GetOrganizationDatabaseHost
    Divide
    CreateMariaDatabaseContainer
    Divide
}

GetOrganizationDatabaseHost