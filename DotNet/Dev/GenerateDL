#!/bin/bash


. /HolismHolding/Infra/Scripts/ExtractAndExportData.sh

function GenerateDL() {

    if [ ! -f "$PWD/Database.json" ]; then
        echo -e '\033[0;31m'"not found Database.json";
        exit;
    fi

    if [ ! -f "$PWD/Models/Models.csproj" ]; then
        echo -e '\033[0;31m'"Project type = Unknown";
        exit;
    fi

    if [ ! -f "$PWD/DataAccess/DataAccess.csproj" ]; then
        echo -e '\033[0;31m'"Project type = Unknown";
        exit;
    fi

    Directory=$PWD

    # if [ ! -f /HolismDotNet/Infra/ModelGenerator/bin/Holism.ModelGenerator.dll ]; then
    # fi
    # if [ ! -f /HolismDotNet/Infra/DataAccessGenerator/bin/Holism.DataAccessGenerator.dll ]; then
    # fi

    dotnet build /HolismDotNet/Infra/DataAccessGenerator
    dotnet build /HolismDotNet/Infra/ModelGenerator

    cd /HolismDotNet/Infra/DataAccessGenerator
    dotnet run $Directory $Organization $OrganizationPrefix $Repository 
   
    cd /HolismDotNet/Infra/ModelGenerator
    dotnet run $Directory $Organization $OrganizationPrefix $Repository 

}

ExtractAndExportData
GenerateDL
