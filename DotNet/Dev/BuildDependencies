. /HolismHolding/Infra/Scripts/Message.sh

if [ ! -f "$PWD/Dependencies" ]; then
    Error "Can't find the file Dependencies";
    exit;
fi

dotnet build /HolismDotNet/Infra
cp $PWD/ConnectionStrings.json /HolismDotNet/Generation/bin
sudo chmod -R 777 $PWD

while read Dependency; do  
    
    Org=$(echo $Dependency | cut -d'/' -f1)
    Repo=$(echo $Dependency | cut -d'/' -f2)
    
    Info "${Org} ${Repo}"

    # if [ ! -f "/$Org/$Repo/Database.json" ]; then
    #     echo "${red}not found Database.json for $Org/$Repo${reset}";
    # else 
    #     dotnet /HolismDotNet/Generation/bin/Holism.Generation.dll "/$Org/$Repo" $Organization "OrganizationPrefix" $Repo "GenerateDatabaseOnly" 
    #     echo -e "${magenta} ${Org} ${Repo}  database generated  ${reset}"
    # fi

    find /$Org/$Repo -type d -name "bin" | xargs sudo rm -rf
    find /$Org/$Repo -type d -name "obj" | xargs sudo rm -rf
    # find /$Org/$Repo -type d -name "Packages" | xargs sudo rm -rf
    cd /$Org/$Repo    
    dotnet build 

done <<< "$({ cat "$PWD/Dependencies"; echo; })"

Info $PWD;
dotnet build $PWD
