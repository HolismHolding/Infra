. /HolismHolding/Infra/Scripts/Message.sh

echo
Info 'What is the WiFi name?'
read WiFiName

if [ $WiFiName == '' ]; then
    Error "WiFi name can not be empty"
    exit;
fi

Success "Now checking ..."
echo

while true; do
    AverageTime=$(ping -q -c5 192.168.1.1 | awk -F'[/=]' 'END{print $6}')
    IsSlow=$(echo "scale=2; ($AverageTime > 5)" | bc)
    if [ $IsSlow == "1" ]; then
        Warning "WiFi got slow. Average ping time is $AverageTime. Reconnecting ..."
        nmcli con down $WiFiName
        nmcli device wifi connect $WiFiName
        Success "Reconnected to WiFi."
    else
        Info "Average ping time $AverageTime"
    fi
done